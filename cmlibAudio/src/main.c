#include <pspimpose_driver.h>
#include "cmlibaudio.h"

PSP_MODULE_INFO("cmlibAudio", PSP_MODULE_KERNEL, 1, 0);


int ioflag = 0;
int muteflag = 0;


////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioGetVolume
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libAudioGetVolume(void)
{
  return sceImposeGetParam(PSP_IMPOSE_MAIN_VOLUME);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioSetVolume
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libAudioSetVolume(int value)
{
  return sceImposeSetParam(PSP_IMPOSE_MAIN_VOLUME, value);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioMuteSet
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

bool libAudioMuteSet()
{
	if(ioflag < 0)muteflag = 0;
	sceImposeSetParam(PSP_IMPOSE_MUTE, (muteflag > 0 ? 1 : 0) );
	return (muteflag >0 ? true : false);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioMuteOn
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libAudioMuteOn(bool *status)
{
	if(*status != true){
		*status = true;
		muteflag ++;
		libAudioMuteSet();
		return 0;
	}
	return -1;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioMuteOff
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libAudioMuteOff(bool *status)
{
	if(*status == true){
		*status = false;
		muteflag --;
		libAudioMuteSet();
		return 0;
	}
	return -1;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioMuteGetStatus
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libAudioMuteGetStatus(void)
{
  return sceImposeGetParam(PSP_IMPOSE_MUTE);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioMuteSetAgain
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

bool libAudioMuteSetAgain(void)
{
  return libAudioMuteSet();
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioIoSet
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int sceSysregAudioIoEnable(int no);
int sceSysregAudioIoDisable(int no);

bool libAudioIoSet()
{
	if(ioflag < 0)ioflag = 0;
	int k1 = pspSdkSetK1(0);
	(ioflag > 0 ? sceSysregAudioIoDisable(0) : sceSysregAudioIoEnable(0));
	pspSdkSetK1(k1);
	return (ioflag >0 ? true : false);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioIoEnable
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libAudioIoEnable(bool *status)
{
	if(*status != false){
		*status = false;
		ioflag --;
		libAudioIoSet();
		return 0;
	}
	return -1;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioIoDisable
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int libAudioIoDisable(bool *status)
{
	if(*status == false){
		*status = true;
		ioflag ++;
		libAudioIoSet();
		return 0;
	}
	return -1;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioIoGetStatus
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

bool libAudioIoGetStatus()
{
	return (ioflag >0 ? true : false);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  libAudioIoSetAgain
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

bool libAudioIoSetAgain()
{
	return libAudioIoSet();
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  ENTRY POINT
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int module_start(SceSize args, void *argp)
{
	return 0;
}

int module_stop(SceSize args, void *argp)
{
	return 0;
}
